<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thanh Toán - Poly Shop</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
	<div class="container my-5">
		<h2 class="mb-4">
			<i class="fas fa-shopping-bag"></i> Thanh Toán
		</h2>

		<!-- Flash Messages -->
		<div th:if="${message}"
			th:class="'alert alert-' + ${messageType == 'success' ? 'success' : 'danger'} + ' alert-dismissible fade show'"
			role="alert">
			<span th:text="${message}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<div class="row">
			<!-- Order Summary -->
			<div class="col-md-4 order-md-2 mb-4">
        <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary">Đơn hàng của bạn</span>
            <span class="badge bg-primary rounded-pill" th:text="${cartItems.size()}">0</span>
        </h4>

        <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between lh-sm"
                th:each="item : ${cartItems}">
                <div>
                    <h6 class="my-0" th:text="${item.product.name}">Product name</h6>
                    <small class="text-muted"
                           th:text="'Số lượng: ' + ${item.quantity}">Quantity</small>
                </div>
                <span class="text-muted"
                      th:text="${#numbers.formatDecimal(item.product.price * item.quantity, 0, 'COMMA', 0, 'POINT')} + ' ₫'">Price</span>
            </li>

            <li class="list-group-item d-flex justify-content-between">
                <span><strong>Tổng tạm tính</strong></span>
                <strong id="subtotal"
                        th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ₫'">0 ₫</strong>
            </li>

            <li id="discountRow" class="list-group-item d-flex justify-content-between text-success d-none">
                <span>Giảm giá (<span id="voucherCodeText"></span>)</span>
                <strong id="discountValue">- 0 ₫</strong>
            </li>

            <li id="totalRow" class="list-group-item d-flex justify-content-between fw-bold">
                <span>Tổng sau giảm</span>
                <strong id="totalAfter"
                        th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ₫'">0 ₫</strong>
            </li>
        </ul>
    </div>

			<!-- Checkout Form -->
			<div class="col-md-8 order-md-1">
				<h4 class="mb-3">Thông tin giao hàng</h4>

				<form th:action="@{/cart/checkout}" method="post"
					class="needs-validation" novalidate>
					<div class="row g-3">
						<div class="col-12">
							<label for="fullName" class="form-label">Họ và tên</label> <input
								type="text" class="form-control" id="fullName"
								th:value="${account != null ? account.fullName : ''}" readonly>
						</div>

						<div class="col-12">
							<label for="phone" class="form-label">Số điện thoại <span
								class="text-danger">*</span></label> <input type="tel"
								class="form-control" id="phone" name="phone"
								th:value="${account != null ? account.phone : ''}"
								pattern="[0-9]{10,11}" required>
							<div class="invalid-feedback">Vui lòng nhập số điện thoại
								hợp lệ (10-11 số).</div>
						</div>

						<div class="col-12">
							<label for="shippingAddress" class="form-label">Địa chỉ
								giao hàng <span class="text-danger">*</span>
							</label>
							<textarea class="form-control" id="shippingAddress"
								name="shippingAddress" rows="3" required
								th:text="${account != null ? account.address : ''}"></textarea>
							<div class="invalid-feedback">Vui lòng nhập địa chỉ giao
								hàng.</div>
						</div>

						<div class="col-12">
							<label for="note" class="form-label">Ghi chú đơn hàng
								(Tùy chọn)</label>
							<textarea class="form-control" id="note" name="note" rows="2"
								placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay chỉ dẫn địa điểm giao hàng chi tiết hơn"></textarea>
						</div>
					</div>

					<hr class="my-4">

					<h4 class="mb-3">Phương thức thanh toán</h4>

					<div class="my-3">
						<div class="form-check">
							<input id="cod" name="paymentMethod" type="radio"
								class="form-check-input" checked required> <label
								class="form-check-label" for="cod"> <i
								class="fas fa-money-bill-wave"></i> Thanh toán khi nhận hàng
								(COD)
							</label>
						</div>
						<div class="form-check">
							<input id="banking" name="paymentMethod" type="radio"
								class="form-check-input" required disabled> <label
								class="form-check-label text-muted" for="banking"> <i
								class="fas fa-university"></i> Chuyển khoản ngân hàng (Sắp ra
								mắt)
							</label>
						</div>
					</div>



					<hr class="my-4">

					<h4 class="mb-3">Mã giảm giá</h4>
            <div class="input-group mb-3">
    <input type="text" id="voucherCode" class="form-control" placeholder="Nhập mã giảm giá (nếu có)">
    <button id="applyVoucherBtn" class="btn btn-outline-primary" type="button">
        <i class="fas fa-ticket-alt"></i> Áp dụng
    </button>
</div>

<div id="voucherMessage" class="text-success"></div>
<div id="voucherError" class="text-danger"></div>

					<hr class="my-4">

					<div class="d-grid gap-2">
						<button class="btn btn-primary btn-lg" type="submit">
							<i class="fas fa-check-circle"></i> Đặt hàng
						</button>
						<a th:href="@{/cart}" class="btn btn-outline-secondary"> <i
							class="fas fa-arrow-left"></i> Quay lại giỏ hàng
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		// Form validation
		(function() {
			'use strict';
			var forms = document.querySelectorAll('.needs-validation');
			Array.prototype.slice.call(forms).forEach(function(form) {
				form.addEventListener('submit', function(event) {
					if (!form.checkValidity()) {
						event.preventDefault();
						event.stopPropagation();
					}
					form.classList.add('was-validated');
				}, false);
			});
		})();
	</script>
</body>
</html>
